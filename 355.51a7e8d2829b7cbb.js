"use strict";(self.webpackChunkuptc_music=self.webpackChunkuptc_music||[]).push([[355],{9355:(F,u,a)=>{a.r(u),a.d(u,{BuitresDetailComponent:()=>j});var l=a(177),d=a(8435),c=a(4341),e=a(6276),_=a(8440),p=a(3205);function f(r,o){1&r&&e.nrm(0,"i",42)}function g(r,o){1&r&&e.nrm(0,"i",43)}function b(r,o){if(1&r){const t=e.RV6();e.j41(0,"div",44)(1,"button",45),e.bIt("click",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.startEditing())}),e.nrm(2,"i",46),e.EFF(3," Editar "),e.k0s(),e.j41(4,"button",47),e.bIt("click",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.deletePerson())}),e.nrm(5,"i",48),e.EFF(6," Eliminar Perfil "),e.k0s()()}}function h(r,o){1&r&&e.nrm(0,"i",54)}function v(r,o){if(1&r){const t=e.RV6();e.j41(0,"i",55),e.bIt("click",function(n){e.eBV(t);const s=e.XpG().$implicit,m=e.XpG(2);return n.stopPropagation(),e.Njj(m.deleteDetail(s.id))}),e.k0s()}}function C(r,o){if(1&r){const t=e.RV6();e.j41(0,"div",49)(1,"span",50),e.bIt("click",function(){const s=e.eBV(t).$implicit,m=e.XpG(2);return e.Njj(m.incrementDetail(s.content))}),e.EFF(2),e.k0s(),e.j41(3,"div",51),e.EFF(4),e.DNE(5,h,1,0,"i",52),e.DNE(6,v,1,0,"i",53),e.k0s()()}if(2&r){const t=o.$implicit,i=e.XpG(2);e.AVh("verified",t.is_verified),e.R7$(2),e.JRh(t.content),e.R7$(2),e.SpI(" ",t.occurrence_count," "),e.R7$(1),e.Y8G("ngIf",t.is_verified),e.R7$(1),e.Y8G("ngIf",i.isAdmin)}}function k(r,o){if(1&r){const t=e.RV6();e.j41(0,"button",65),e.bIt("click",function(){e.eBV(t);const n=e.XpG().$implicit,s=e.XpG(2);return e.Njj(s.deleteComment(n.id))}),e.nrm(1,"i",66),e.k0s()}}function D(r,o){if(1&r&&(e.j41(0,"div",56)(1,"div",57)(2,"div")(3,"span",58),e.EFF(4),e.nI1(5,"slice"),e.k0s(),e.j41(6,"small",59),e.EFF(7),e.nI1(8,"date"),e.k0s()(),e.DNE(9,k,2,0,"button",60),e.k0s(),e.j41(10,"p",61),e.EFF(11),e.k0s(),e.j41(12,"div",62)(13,"span",63),e.nrm(14,"i",64),e.EFF(15),e.k0s()()()),2&r){const t=o.$implicit,i=e.XpG(2);e.R7$(4),e.SpI("An\xf3nimo #",e.brH(5,5,t.author_fingerprint,0,5),""),e.R7$(3),e.JRh(e.i5U(8,9,t.created_at,"short")),e.R7$(2),e.Y8G("ngIf",i.isAdmin),e.R7$(2),e.JRh(t.content),e.R7$(4),e.SpI(" ",t.likes_count,"")}}function E(r,o){if(1&r){const t=e.RV6();e.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6),e.DNE(5,f,1,0,"i",7),e.DNE(6,g,1,0,"i",8),e.k0s()(),e.j41(7,"div",9)(8,"div",10)(9,"div",11)(10,"h1",12),e.EFF(11),e.k0s()(),e.DNE(12,b,7,0,"div",13),e.k0s(),e.j41(13,"div",14)(14,"button",15),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.vote("like"))}),e.nrm(15,"i",16),e.EFF(16),e.k0s(),e.j41(17,"button",17),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.vote("dislike"))}),e.nrm(18,"i",18),e.EFF(19),e.k0s(),e.j41(20,"button",19),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.requestRemoval())}),e.nrm(21,"i",20),e.EFF(22," Quiero eliminar mi perfil "),e.k0s()()()()(),e.j41(23,"div",21)(24,"div",22)(25,"div",23)(26,"h3",24),e.nrm(27,"i",25),e.EFF(28,"Etiquetas"),e.k0s(),e.j41(29,"div",26),e.DNE(30,C,7,6,"div",27),e.k0s(),e.j41(31,"div",28)(32,"div",29)(33,"input",30),e.bIt("ngModelChange",function(n){e.eBV(t);const s=e.XpG();return e.Njj(s.newDetailContent=n)})("keyup.enter",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.addDetail())}),e.k0s(),e.j41(34,"button",31),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.addDetail())}),e.nrm(35,"i",32),e.k0s()(),e.j41(36,"small",33),e.EFF(37,"click en los tags para incrementar el numero"),e.k0s()()()(),e.j41(38,"div",34)(39,"div",35)(40,"h3",24),e.nrm(41,"i",36),e.EFF(42,"Foro An\xf3nimo"),e.k0s(),e.j41(43,"div",37)(44,"textarea",38),e.bIt("ngModelChange",function(n){e.eBV(t);const s=e.XpG();return e.Njj(s.newComment=n)}),e.k0s(),e.j41(45,"button",39),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.submitComment())}),e.EFF(46," Publicar Comentario "),e.k0s()(),e.j41(47,"div",40),e.DNE(48,D,16,12,"div",41),e.k0s()()()()()}if(2&r){const t=e.XpG();e.R7$(5),e.Y8G("ngIf","male"===t.person.gender),e.R7$(1),e.Y8G("ngIf","female"===t.person.gender),e.R7$(5),e.JRh(t.person.name),e.R7$(1),e.Y8G("ngIf",t.isAdmin),e.R7$(2),e.Y8G("disabled",t.voting),e.R7$(2),e.SpI("",t.person.likes_count," "),e.R7$(1),e.Y8G("disabled",t.voting),e.R7$(2),e.SpI("",t.person.dislikes_count," "),e.R7$(11),e.Y8G("ngForOf",t.details),e.R7$(3),e.Y8G("ngModel",t.newDetailContent),e.R7$(1),e.Y8G("disabled",!t.newDetailContent),e.R7$(10),e.Y8G("ngModel",t.newComment),e.R7$(1),e.Y8G("disabled",!t.newComment),e.R7$(3),e.Y8G("ngForOf",t.comments)}}function x(r,o){if(1&r){const t=e.RV6();e.j41(0,"div",67),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.isEditing=!1)}),e.j41(1,"div",68),e.bIt("click",function(n){return n.stopPropagation()}),e.j41(2,"h3",69),e.EFF(3,"Editar Perfil"),e.k0s(),e.j41(4,"div",24)(5,"label",70),e.EFF(6,"Nombre"),e.k0s(),e.j41(7,"input",71),e.bIt("ngModelChange",function(n){e.eBV(t);const s=e.XpG();return e.Njj(s.editName=n)}),e.k0s()(),e.j41(8,"div",24)(9,"label",70),e.EFF(10,"Correo Electr\xf3nico"),e.k0s(),e.j41(11,"input",72),e.bIt("ngModelChange",function(n){e.eBV(t);const s=e.XpG();return e.Njj(s.editEmail=n)}),e.k0s()(),e.j41(12,"div",24)(13,"label",70),e.EFF(14,"G\xe9nero"),e.k0s(),e.j41(15,"select",73),e.bIt("ngModelChange",function(n){e.eBV(t);const s=e.XpG();return e.Njj(s.editGender=n)}),e.j41(16,"option",74),e.EFF(17,"Masculino"),e.k0s(),e.j41(18,"option",75),e.EFF(19,"Femenino"),e.k0s()()(),e.j41(20,"div",76)(21,"button",77),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.isEditing=!1)}),e.EFF(22,"Cancelar"),e.k0s(),e.j41(23,"button",78),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.saveEdits())}),e.EFF(24,"Guardar"),e.k0s()()()()}if(2&r){const t=e.XpG();e.R7$(7),e.Y8G("ngModel",t.editName),e.R7$(4),e.Y8G("ngModel",t.editEmail),e.R7$(4),e.Y8G("ngModel",t.editGender)}}let j=(()=>{class r{route;router;buitresService;authService;person=null;details=[];comments=[];newComment="";newDetailContent="";voting=!1;fingerprint="";isAdmin=!1;isEditing=!1;editName="";editEmail="";editGender="";subscriptions=[];constructor(t,i,n,s){this.route=t,this.router=i,this.buitresService=n,this.authService=s}ngOnInit(){this.isAdmin=this.authService.isRoleAdmin(),this.fingerprint=this.getFingerprint(),this.route.params.subscribe(t=>{const i=t.id;i&&(this.loadData(i),this.setupRealtime(i))})}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}getFingerprint(){let t=localStorage.getItem("user_fingerprint");return t||(t=Math.random().toString(36).substring(2)+Date.now().toString(36),localStorage.setItem("user_fingerprint",t)),t}setupRealtime(t){this.subscriptions.push(this.buitresService.subscribeToChanges("buitres_people",i=>{i.new&&i.new.id===t&&(this.person=i.new)})),this.subscriptions.push(this.buitresService.subscribeToChanges("buitres_details",i=>{i.new&&i.new.person_id===t&&this.loadDetails(t)})),this.subscriptions.push(this.buitresService.subscribeToChanges("buitres_comments",i=>{i.new&&i.new.person_id===t&&this.loadComments(t)}))}loadData(t){this.buitresService.getPersonById(t).subscribe(i=>this.person=i),this.loadDetails(t),this.loadComments(t)}loadDetails(t){this.buitresService.getDetails(t).subscribe(i=>this.details=i)}loadComments(t){this.buitresService.getComments(t).subscribe(i=>this.comments=i)}vote(t){!this.person||this.voting||(this.voting=!0,this.buitresService.votePerson(this.person.id,t,this.fingerprint).subscribe({next:()=>{this.loadData(this.person.id),this.voting=!1},error:()=>{alert("Ya has votado por esta persona."),this.voting=!1}}))}submitComment(){this.person&&this.newComment&&((this.newComment.match(/\d/g)||[]).length>=10?alert("Por seguridad, no se permiten comentarios con n\xfameros de tel\xe9fono."):this.buitresService.addComment(this.person.id,this.newComment,this.fingerprint).subscribe(()=>{this.newComment="",this.loadData(this.person.id)}))}addDetail(){if(!this.person||!this.newDetailContent)return;if((this.newDetailContent.match(/\d/g)||[]).length>=10)return void alert("Por seguridad, no se permiten etiquetas con n\xfameros de tel\xe9fono.");const i=this.newDetailContent.toLowerCase().split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" ");this.incrementDetail(i),this.newDetailContent=""}incrementDetail(t){this.person&&this.buitresService.addOrIncrementDetail(this.person.id,t,this.fingerprint).subscribe({next:()=>this.loadData(this.person.id),error:i=>console.error("Error incrementing detail:",i)})}getEmail(t){if(!t)return"";let i=t.email||"";return!i&&t.description&&t.description.includes("@")&&(i=t.description),i.replace("Email: ","").trim()}shouldShowDescription(t){if(!t||!t.description)return!1;const i=this.getEmail(t),n=t.description.replace("Email: ","").trim();return!(!n||n===i||i.includes(n))}startEditing(){this.person&&(this.editName=this.person.name,this.editEmail=this.getEmail(this.person),this.editGender=this.person.gender,this.isEditing=!0)}extractEmailFromDesc(t){return t?t.replace("Email: ","").trim():""}saveEdits(){if(!this.person||!this.editName||!this.editGender)return;const i={name:this.editName.toLowerCase().split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" "),gender:this.editGender,description:this.editEmail||this.person.description};i.email=this.editEmail,this.buitresService.updatePerson(this.person.id,i).subscribe({next:()=>{this.isEditing=!1,this.loadData(this.person.id)},error:n=>{if(console.error("Update error:",n),"PGRST204"===n.code||"42703"===n.code||n.message&&n.message.includes('email" does not exist')||400===n.status){const s={...i};delete s.email,this.buitresService.updatePerson(this.person.id,s).subscribe({next:()=>{this.isEditing=!1,this.loadData(this.person.id)},error:()=>alert("Error al actualizar perfil.")})}else alert("Error al actualizar perfil.")}})}deleteComment(t){confirm("\xbfEst\xe1s seguro de eliminar este comentario?")&&this.buitresService.deleteComment(t).subscribe(()=>{this.person&&this.loadComments(this.person.id)})}deleteDetail(t){confirm("\xbfEst\xe1s seguro de eliminar esta etiqueta?")&&this.buitresService.deleteDetail(t).subscribe(()=>{this.person&&this.loadDetails(this.person.id)})}deletePerson(){this.person&&confirm(`\xbfEst\xe1s seguro de eliminar permanentemente el perfil de "${this.person.name}"? Esta acci\xf3n no se puede deshacer.`)&&this.buitresService.deletePerson(this.person.id).subscribe({next:()=>{this.router.navigate(["/buitres"])},error:t=>alert("Error al eliminar perfil.")})}requestRemoval(){if(!this.person)return;const i=encodeURIComponent(`Solicitud de eliminaci\xf3n de perfil: ${this.person.name}`),n=encodeURIComponent(`Hola johan,\n\nDeseo solicitar la eliminaci\xf3n del perfil "${this.person.name}" (ID: ${this.person.id}) del directorio comunitario de Buitres UPTC.\n\nAtentamente,\nUn integrante de la comunidad.`);window.location.href=`mailto:johan.vega01@uptc.edu.co?subject=${i}&body=${n}`}static \u0275fac=function(i){return new(i||r)(e.rXU(d.nX),e.rXU(d.Ix),e.rXU(_.m),e.rXU(p.u))};static \u0275cmp=e.VBU({type:r,selectors:[["app-buitres-detail"]],standalone:!0,features:[e.aNF],decls:2,vars:2,consts:[["class","detail-container mt-4 animate-fade-in",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"detail-container","mt-4","animate-fade-in"],[1,"profile-header","card-dark","mb-4"],[1,"row","align-items-center"],[1,"col-md-3"],[1,"profile-img","d-flex","align-items-center","justify-content-center"],["class","fas fa-user-tie gender-avatar male",4,"ngIf"],["class","fas fa-user-graduate gender-avatar female",4,"ngIf"],[1,"col-md-9"],[1,"d-flex","align-items-center","justify-content-center","gap-3"],[1,"person-title-section"],[1,"person-name","mb-0"],["class","d-flex gap-2",4,"ngIf"],[1,"vote-actions","mt-3","d-flex","align-items-center","gap-2"],[1,"btn","btn-outline-success",3,"disabled","click"],[1,"fas","fa-thumbs-up","me-2"],[1,"btn","btn-outline-danger",3,"disabled","click"],[1,"fas","fa-thumbs-down","me-2"],[1,"btn","btn-link","text-muted","btn-sm","ms-auto","text-decoration-none",3,"click"],[1,"fas","fa-user-slash","me-1"],[1,"row"],[1,"col-md-4"],[1,"card-dark","h-100"],[1,"mb-3"],[1,"fas","fa-tags","me-2","text-primary"],[1,"tags-container","mb-3"],["class","tag-item",3,"verified",4,"ngFor","ngForOf"],[1,"add-tag","mt-auto"],[1,"input-group"],["type","text","placeholder","Agregar etiqueta...",1,"form-control","form-dark",3,"ngModel","ngModelChange","keyup.enter"],[1,"btn","btn-primary",3,"disabled","click"],[1,"fas","fa-plus"],[1,"text-muted","mt-2","d-block"],[1,"col-md-8"],[1,"card-dark"],[1,"fas","fa-comments","me-2","text-primary"],[1,"comment-input-area","mb-4"],["rows","3","placeholder","Escribe algo an\xf3nimamente, una vez enviado no se podra editar.",1,"form-control","form-dark",3,"ngModel","ngModelChange"],[1,"btn","btn-primary","mt-2",3,"disabled","click"],[1,"comments-list"],["class","comment-card",4,"ngFor","ngForOf"],[1,"fas","fa-user-tie","gender-avatar","male"],[1,"fas","fa-user-graduate","gender-avatar","female"],[1,"d-flex","gap-2"],[1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"fas","fa-edit","me-1"],[1,"btn","btn-outline-danger","btn-sm",3,"click"],[1,"fas","fa-trash-alt","me-1"],[1,"tag-item"],[1,"tag-content",3,"click"],[1,"tag-badge"],["class","fas fa-check-circle ms-1",4,"ngIf"],["class","fas fa-times ms-2 text-danger cursor-pointer",3,"click",4,"ngIf"],[1,"fas","fa-check-circle","ms-1"],[1,"fas","fa-times","ms-2","text-danger","cursor-pointer",3,"click"],[1,"comment-card"],[1,"comment-header","d-flex","justify-content-between"],[1,"anon-id"],[1,"text-muted","ms-2"],["class","btn btn-link text-danger btn-sm p-0",3,"click",4,"ngIf"],[1,"comment-body"],[1,"comment-footer"],[1,"text-muted"],[1,"fas","fa-heart","me-1"],[1,"btn","btn-link","text-danger","btn-sm","p-0",3,"click"],[1,"fas","fa-trash-alt"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[1,"text-white"],[1,"form-label","text-white"],["type","text",1,"form-control","form-dark",3,"ngModel","ngModelChange"],["type","email",1,"form-control","form-dark",3,"ngModel","ngModelChange"],[1,"form-select","form-dark",3,"ngModel","ngModelChange"],["value","male"],["value","female"],[1,"d-flex","justify-content-end","gap-2","mt-4"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-primary",3,"click"]],template:function(i,n){1&i&&(e.DNE(0,E,49,14,"div",0),e.DNE(1,x,25,3,"div",1)),2&i&&(e.Y8G("ngIf",n.person),e.R7$(1),e.Y8G("ngIf",n.isEditing&&n.isAdmin))},dependencies:[l.MD,l.Sq,l.bT,l.P9,l.vh,d.iI,c.YN,c.xH,c.y7,c.me,c.wz,c.BC,c.vS],styles:[".card-dark[_ngcontent-%COMP%]{background:#181818;border:1px solid #333;border-radius:15px;padding:25px;color:#fff}.profile-img[_ngcontent-%COMP%]{width:120px;height:120px;border-radius:50%;background:#222;border:4px solid #333}.gender-avatar[_ngcontent-%COMP%]{font-size:4rem}.gender-avatar.male[_ngcontent-%COMP%]{color:#519df5}.gender-avatar.female[_ngcontent-%COMP%]{color:#f551a3}.person-name[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:800;color:#fff}.person-desc[_ngcontent-%COMP%]{color:#b3b3b3;font-size:1.1rem}.tags-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px}.tag-item[_ngcontent-%COMP%]{display:flex;align-items:center;background:#282828;padding:5px 12px;border-radius:20px;border:1px solid #404040;transition:all .2s}.tag-item.verified[_ngcontent-%COMP%]{border-color:#1db954;background:rgba(29,185,84,.1)}.tag-content[_ngcontent-%COMP%]{font-size:.9rem;margin-right:8px}.tag-badge[_ngcontent-%COMP%]{background:#404040;padding:2px 8px;border-radius:10px;font-size:.75rem;cursor:pointer;display:flex;align-items:center}.tag-badge[_ngcontent-%COMP%]:hover{background:#505050}.tag-badge[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#1db954}.comment-card[_ngcontent-%COMP%]{background:#282828;border-radius:10px;padding:15px;margin-bottom:15px}.comment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:8px}.anon-id[_ngcontent-%COMP%]{color:#1db954;font-weight:700;font-size:.9rem}.form-dark[_ngcontent-%COMP%]{background:#282828;border:1px solid #404040;color:#fff}.form-dark[_ngcontent-%COMP%]:focus{background:#333;color:#fff;border-color:#1db954;box-shadow:none}"]})}return r})()}}]);