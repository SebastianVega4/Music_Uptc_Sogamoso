<div class="home-container">

  <!-- Banner de Redirección a Reglas -->
  <div class="rules-banner mb-4 fade-in">
    <a routerLink="/about" class="rules-card">
      <div class="rules-content">
        <div class="rules-icon">
          <i class="fas fa-book-open"></i>
        </div>
        <div class="rules-text">
          <span class="rules-title">Reglas y funcionamiento de la seccion de Buitres:</span>
          <span class="rules-action">Ver Reglamento <i class="fas fa-arrow-right ms-1"></i></span>
        </div>
      </div>
    </a>
  </div>

  <div class="alert alert-warning alert-dismissible fade show mb-4 animate-fade-in" role="alert" *ngIf="showLoginAlert">
    <div class="d-flex align-items-center">
      <i class="fas fa-exclamation-triangle me-3 fa-2x"></i>
      <div>
        <strong>Acceso Restringido:</strong> Para ver el perfil detallado de los "Buitres", primero debes iniciar sesión
        con tu cuenta UPTC en el apartado correspondiente.
        <div class="mt-2">
          <a href="/buitres" class="btn btn-sm btn-warning fw-bold text-dark">Ir a Buitres y Acceder</a>
        </div>
      </div>
    </div>
    <button type="button" class="btn-close" (click)="showLoginAlert = false" aria-label="Close"></button>
  </div>

  <!-- Sección de siguiente canción -->
  <div class="next-song-section compact-card fade-in">
    <div class="card-header">
      <i class="fas fa-forward text-primary"></i>
      <span class="header-title">Siguiente en la cola</span>
    </div>

    <div class="next-song-content" *ngIf="nextSong; else noNextSong">
      <div class="album-art-mini">
        <img [src]="nextSong.image || 'assets/default-song.png'" alt="Carátula" class="album-art-img">
      </div>
      <div class="song-info-mini">
        <h4 class="song-title-mini">{{ nextSong.name }}</h4>
        <p class="song-artist-mini">{{ nextSong.artists.join(', ') }}</p>
      </div>
    </div>

    <ng-template #noNextSong>
      <div class="no-next-song-content">
        <p class="text-muted small mb-0">No hay canciones en la cola de Spotify</p>
      </div>
    </ng-template>
  </div>

  <!-- Mensaje cuando no hay canción -->
  <ng-template #noSongPlaying>
    <div class="no-song-playing compact-card fade-in">
      <div class="card-body">
        <i class="fas fa-music-slash text-muted"></i>
        <p class="text-muted">No hay música sonando.</p>
      </div>
    </div>
  </ng-template>

  <!-- Sección de canción en reproducción -->
  <div class="now-playing-section compact-card fade-in" *ngIf="adminCurrentlyPlaying; else noSongPlaying">
    <div class="album-art-container">
      <img [src]="adminCurrentlyPlaying.image" alt="Carátula de {{ adminCurrentlyPlaying.name }}" class="album-art">
    </div>
    <div class="song-info-container">
      <div class="song-details">
        <h3 class="song-title">{{ adminCurrentlyPlaying.name }}</h3>
        <p class="song-artist">{{ adminCurrentlyPlaying.artists }}</p>
        <p *ngIf="adminCurrentlyPlaying.dedication" class="text-info fst-italic mb-0 mt-1">
          <i class="fas fa-heart me-1"></i>{{ adminCurrentlyPlaying.dedication }}
        </p>
      </div>
      <div class="progress-container">
        <span class="time-display">{{ formatTime(progress * songDurationMs / 100) }}</span>
        <div class="progress">
          <div class="progress-bar" [style.width.%]="progress"></div>
        </div>
        <span class="time-display">{{ formatTime(songDurationMs) }}</span>
      </div>
    </div>
    <div class="update-button-container">
      <button class="btn btn-icon" (click)="forceUpdate()" [disabled]="isUpdating" title="Actualizar">
        <i class="fas fa-sync-alt" [class.fa-spin]="isUpdating"></i>
      </button>
    </div>
  </div>
  <div class="voting-section">
    <app-voting *ngIf="adminCurrentlyPlaying"></app-voting>
  </div>

  <!-- Componente de búsqueda -->
  <app-search (voteCasted)="onVoteCasted()"></app-search>
  <app-voting-list></app-voting-list>

</div>