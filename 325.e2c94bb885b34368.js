"use strict";(self.webpackChunkuptc_music=self.webpackChunkuptc_music||[]).push([[325],{3325:(R,C,a)=>{a.r(C),a.d(C,{RankingComponent:()=>I});var _=a(177),f=a(4341),v=a(8435),t=a(540),M=a(1626),h=a(5312);let p=(()=>{class r{http;apiUrl=h.c.apiUrl;constructor(e){this.http=e}getSongHistory(e="times_played",o="desc"){let n=(new M.Nl).set("sort_by",e).set("order",o);return this.http.get(`${this.apiUrl}/api/ranking/history`,{params:n})}voteFromHistory(e){return this.http.post(`${this.apiUrl}/api/ranking/vote-from-history`,{track_id:e})}getRankingStats(){return this.http.get(`${this.apiUrl}/api/ranking/stats`)}forceRankCurrentSong(){return this.http.post(`${this.apiUrl}/api/ranking/force-rank-current`,{})}static \u0275fac=function(o){return new(o||r)(t.KVO(M.Qq))};static \u0275prov=t.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var x=a(1180),O=a(3824),P=a(2915);function m(r,b){if(1&r&&(t.j41(0,"div",42),t.EFF(1),t.k0s()),2&r){const e=t.XpG();t.R7$(1),t.SpI(" ",e.voteMessage," ")}}function s(r,b){if(1&r){const e=t.RV6();t.j41(0,"button",43),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.filterText="")}),t.nrm(1,"i",44),t.k0s()}}function l(r,b){if(1&r&&(t.j41(0,"div",45),t.nrm(1,"i",46),t.EFF(2),t.k0s()),2&r){const e=t.XpG();t.R7$(2),t.SpI(" ",e.error," ")}}function d(r,b){1&r&&(t.j41(0,"div",47),t.nrm(1,"div",48),t.j41(2,"p",6),t.EFF(3,"Cargando ranking hist\xf3rico..."),t.k0s()())}function k(r,b){1&r&&t.nrm(0,"i",72)}function i(r,b){1&r&&t.nrm(0,"i",73)}function c(r,b){if(1&r){const e=t.RV6();t.j41(0,"div",51)(1,"div",52)(2,"div",53),t.nrm(3,"img",54),t.j41(4,"div",55),t.EFF(5),t.k0s()(),t.j41(6,"div",56)(7,"h5",57),t.EFF(8),t.k0s(),t.j41(9,"p",58),t.EFF(10),t.k0s(),t.j41(11,"div",59)(12,"span",60),t.nrm(13,"i",61),t.EFF(14),t.k0s(),t.j41(15,"span",60),t.nrm(16,"i",62),t.EFF(17),t.k0s(),t.j41(18,"span",60),t.nrm(19,"i",63),t.EFF(20),t.k0s()(),t.j41(21,"div",64),t.bIt("click",function(){const u=t.eBV(e).$implicit,E=t.XpG(2);return t.Njj(E.onShowDetails(u))}),t.j41(22,"div",65),t.nrm(23,"div",66),t.k0s(),t.j41(24,"span",67),t.EFF(25),t.k0s()(),t.j41(26,"p",68),t.EFF(27),t.k0s(),t.j41(28,"button",69),t.bIt("click",function(){const u=t.eBV(e).$implicit,E=t.XpG(2);return t.Njj(E.onVote(u))}),t.DNE(29,k,1,0,"i",70),t.DNE(30,i,1,0,"i",71),t.EFF(31," Votar "),t.k0s()()()()}if(2&r){const e=b.$implicit,o=b.index,n=t.XpG(2);t.R7$(3),t.Y8G("src",e.image||"assets/default-song.png",t.B4B)("alt",e.name),t.R7$(2),t.SpI("#",o+1,""),t.R7$(3),t.JRh(e.name),t.R7$(2),t.JRh(e.artists.join(", ")),t.R7$(4),t.SpI(" ",e.times_played," "),t.R7$(3),t.SpI(" ",e.total_votes," "),t.R7$(3),t.SpI(" ",e.total_dislikes," "),t.R7$(3),t.xc7("width",n.getVotePercentage(e),"%"),t.R7$(2),t.SpI("",n.getVotePercentage(e),"% aprobaci\xf3n"),t.R7$(2),t.JRh(n.formatDate(e.last_played_at)),t.R7$(1),t.Y8G("disabled",n.isVoting),t.R7$(1),t.Y8G("ngIf",!n.isVoting),t.R7$(1),t.Y8G("ngIf",n.isVoting)}}function g(r,b){if(1&r&&(t.j41(0,"div",49),t.DNE(1,c,32,15,"div",50),t.k0s()),2&r){const e=t.XpG();t.R7$(1),t.Y8G("ngForOf",e.getTabSongs())}}function y(r,b){1&r&&(t.j41(0,"div",47),t.nrm(1,"i",74),t.j41(2,"h4",6),t.EFF(3,"No se encontraron canciones"),t.k0s(),t.j41(4,"p",6),t.EFF(5,"Intenta con otros t\xe9rminos de b\xfasqueda"),t.k0s()())}function S(r,b){if(1&r){const e=t.RV6();t.j41(0,"div",75),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.onCloseDetails())}),t.k0s()}}function F(r,b){1&r&&t.nrm(0,"i",72)}function j(r,b){1&r&&t.nrm(0,"i",73)}function w(r,b){if(1&r){const e=t.RV6();t.j41(0,"div",76)(1,"div",77)(2,"div",78)(3,"div",79)(4,"h5",80),t.nrm(5,"i",81),t.EFF(6,"Detalles de la Canci\xf3n "),t.k0s(),t.j41(7,"button",82),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.onCloseDetails())}),t.EFF(8," Cerrar "),t.k0s()(),t.j41(9,"div",83)(10,"div",84)(11,"div",85),t.nrm(12,"img",86),t.j41(13,"button",69),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.onVote(n.selectedSong))}),t.DNE(14,F,1,0,"i",70),t.DNE(15,j,1,0,"i",71),t.EFF(16," Votar por esta canci\xf3n "),t.k0s()(),t.j41(17,"div",87)(18,"h4",6),t.EFF(19),t.k0s(),t.j41(20,"p",6),t.EFF(21),t.k0s(),t.j41(22,"div",88)(23,"div",89)(24,"div",90)(25,"h3",91),t.EFF(26),t.k0s(),t.j41(27,"p",92),t.EFF(28,"Reproducciones"),t.k0s()()(),t.j41(29,"div",89)(30,"div",90)(31,"h3",93),t.EFF(32),t.k0s(),t.j41(33,"p",92),t.EFF(34,"Votos positivos"),t.k0s()()(),t.j41(35,"div",94)(36,"div",90)(37,"h3",95),t.EFF(38),t.k0s(),t.j41(39,"p",92),t.EFF(40,"Votos negativos"),t.k0s()()(),t.j41(41,"div",94)(42,"div",90)(43,"h3",96),t.EFF(44),t.k0s(),t.j41(45,"p",92),t.EFF(46,"Porcentaje de aprobaci\xf3n"),t.k0s()()()(),t.j41(47,"div",97)(48,"h6",6),t.EFF(49,"\xdaltima reproducci\xf3n"),t.k0s(),t.j41(50,"p",6),t.EFF(51),t.k0s(),t.j41(52,"h6",6),t.EFF(53,"D\xedas desde la \xfaltima reproducci\xf3n"),t.k0s(),t.j41(54,"p",6),t.EFF(55),t.k0s()()()()()()()()}if(2&r){const e=t.XpG();t.R7$(12),t.Y8G("src",e.selectedSong.image||"assets/default-song.png",t.B4B)("alt",e.selectedSong.name),t.R7$(1),t.Y8G("disabled",e.isVoting),t.R7$(1),t.Y8G("ngIf",!e.isVoting),t.R7$(1),t.Y8G("ngIf",e.isVoting),t.R7$(4),t.JRh(e.selectedSong.name),t.R7$(2),t.JRh(e.selectedSong.artists.join(", ")),t.R7$(5),t.JRh(e.selectedSong.times_played),t.R7$(6),t.JRh(e.selectedSong.total_votes),t.R7$(6),t.JRh(e.selectedSong.total_dislikes),t.R7$(6),t.SpI("",e.getVotePercentage(e.selectedSong),"%"),t.R7$(7),t.JRh(e.formatDate(e.selectedSong.last_played_at)),t.R7$(4),t.SpI("",e.getDaysSinceLastPlayed(e.selectedSong)," d\xedas")}}let I=(()=>{class r{rankingService;votingService;audioService;metaService;songs=[];isLoading=!0;error="";sortBy="times_played";sortOrder="desc";filterText="";selectedSong=null;isVoting=!1;voteMessage="";activeTab="all";stats={};pollingSubscription=null;constructor(e,o,n,u){this.rankingService=e,this.votingService=o,this.audioService=n,this.metaService=u}ngOnInit(){this.metaService.updatePageData("Ranking de Canciones","Mira las canciones m\xe1s votadas y el historial de reproducci\xf3n."),this.loadRanking(),this.startPolling()}ngOnDestroy(){this.pollingSubscription&&this.pollingSubscription.unsubscribe()}startPolling(){this.pollingSubscription=this.votingService.getRankedSongsPolling().subscribe({next:()=>{this.loadRanking()}})}loadRanking(){this.isLoading=!0,this.error="",this.rankingService.getSongHistory(this.sortBy,this.sortOrder).subscribe({next:e=>{this.songs=e,this.calculateStats(),this.isLoading=!1},error:e=>{console.error("Error loading ranking:",e),this.error="Error al cargar el ranking. Intenta nuevamente.",this.isLoading=!1}})}calculateStats(){0!==this.songs.length?(this.stats.totalSongs=this.songs.length,this.stats.totalPlays=this.songs.reduce((e,o)=>e+o.times_played,0),this.stats.totalVotes=this.songs.reduce((e,o)=>e+o.total_votes,0),this.stats.totalDislikes=this.songs.reduce((e,o)=>e+o.total_dislikes,0),this.stats.mostPlayed=this.songs.reduce((e,o)=>o.times_played>e.times_played?o:e,this.songs[0]),this.stats.mostVoted=this.songs.reduce((e,o)=>o.total_votes>e.total_votes?o:e,this.songs[0]),this.stats.bestRated=this.songs.reduce((e,o)=>this.getVotePercentage(o)>this.getVotePercentage(e)?o:e,this.songs[0])):this.stats={}}onSortChange(e){this.sortBy===e?this.sortOrder="desc"===this.sortOrder?"asc":"desc":(this.sortBy=e,this.sortOrder="desc"),this.loadRanking()}getSortIcon(e){return this.sortBy!==e?"fa-sort":"desc"===this.sortOrder?"fa-sort-down":"fa-sort-up"}onVote(e){this.isVoting=!0,this.voteMessage="",this.rankingService.voteFromHistory(e.track_id).subscribe({next:o=>{this.voteMessage="Agregada a Ranking de Votacion",this.isVoting=!1;const n=this.songs.findIndex(u=>u.track_id===e.track_id);-1!==n&&(this.songs[n].total_votes+=1,this.calculateStats()),setTimeout(()=>{this.voteMessage=""},5e3)},error:o=>{console.error("Error voting:",o),this.voteMessage=o.error?.error||"Error al votar",this.isVoting=!1,setTimeout(()=>{this.voteMessage=""},5e3)}})}onShowDetails(e){this.selectedSong=e}onCloseDetails(){this.selectedSong=null}get filteredSongs(){if(!this.filterText)return this.songs;const e=this.filterText.toLowerCase();return this.songs.filter(o=>o.name.toLowerCase().includes(e)||o.artists.some(n=>n.toLowerCase().includes(e)))}getVotePercentage(e){return e.total_votes||e.total_dislikes?Math.round(e.total_votes/(e.total_votes+e.total_dislikes)*100):0}formatDate(e){const o=new Date(e);return new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}).format(o)}getDaysSinceLastPlayed(e){const o=new Date(e.last_played_at),u=Math.abs((new Date).getTime()-o.getTime());return Math.floor(u/864e5)}setActiveTab(e){this.activeTab=e}getTabSongs(){switch(this.activeTab){case"mostPlayed":return[...this.filteredSongs].sort((e,o)=>o.times_played-e.times_played);case"mostVoted":return[...this.filteredSongs].sort((e,o)=>o.total_votes-e.total_votes);case"bestRated":return[...this.filteredSongs].sort((e,o)=>{const n=this.getVotePercentage(e);return this.getVotePercentage(o)-n});default:return this.filteredSongs}}playPreview(e,o){o.stopPropagation(),e?this.audioService.play(e):alert("Esta canci\xf3n no tiene vista previa disponible.")}static \u0275fac=function(o){return new(o||r)(t.rXU(p),t.rXU(x.Z),t.rXU(O.U),t.rXU(P.R))};static \u0275cmp=t.VBU({type:r,selectors:[["app-ranking"]],standalone:!0,features:[t.aNF],decls:88,vars:30,consts:[[1,"ranking-container","fade-in"],[1,"message-container"],["class","success-message",4,"ngIf"],[1,"header-section"],[1,"gradient-text"],[1,"fas","fa-trophy","me-2"],[1,"text-muted"],[1,"stats-grid","mb-4"],[1,"stat-card","card"],[1,"card-body","text-center"],[1,"fas","fa-music","stat-icon"],[1,"stat-value"],[1,"stat-label"],[1,"fas","fa-play-circle","stat-icon"],[1,"fas","fa-thumbs-up","stat-icon"],[1,"fas","fa-thumbs-down","stat-icon"],[1,"tabs-container","mb-4"],[1,"nav","nav-tabs"],[1,"nav-item"],[1,"nav-link",3,"click"],[1,"fas","fa-list","me-1"],[1,"fas","fa-play-circle","me-1"],[1,"fas","fa-thumbs-up","me-1"],[1,"fas","fa-star","me-1"],[1,"filters-card","card","mb-4"],[1,"card-body"],[1,"row","align-items-center"],[1,"col-md-6","mb-3","mb-md-0"],[1,"search-container"],[1,"fas","fa-search","search-icon"],["type","text","placeholder","Buscar canci\xf3n o artista...",1,"search-input",3,"ngModel","ngModelChange"],["class","search-clear",3,"click",4,"ngIf"],[1,"col-md-6"],[1,"d-flex","flex-wrap","gap-2","justify-content-md-end"],[1,"text-muted","me-2"],[1,"btn","btn-sm","btn-outline-secondary",3,"click"],[1,"fas","fa-calendar","me-1"],["class","alert alert-danger","role","alert",4,"ngIf"],["class","text-center py-5",4,"ngIf"],["class","songs-grid",4,"ngIf"],["class","modal-backdrop show",3,"click",4,"ngIf"],["class","modal show d-block","tabindex","-1",4,"ngIf"],[1,"success-message"],[1,"search-clear",3,"click"],[1,"fas","fa-times"],["role","alert",1,"alert","alert-danger"],[1,"fas","fa-exclamation-triangle","me-2"],[1,"text-center","py-5"],[1,"loading-spinner","mb-3"],[1,"songs-grid"],["class","song-card spotify-card",4,"ngFor","ngForOf"],[1,"song-card","spotify-card"],[1,"card-content"],[1,"song-image-container"],[1,"song-image",3,"src","alt"],[1,"position-badge"],[1,"song-info"],[1,"song-title","text-truncate"],[1,"song-artist","text-truncate"],[1,"song-stats"],[1,"stat-item"],[1,"fas","fa-play"],[1,"fas","fa-thumbs-up"],[1,"fas","fa-thumbs-down"],[1,"approval-container",3,"click"],[1,"approval-bar"],[1,"approval-progress"],[1,"approval-text"],[1,"last-played"],[1,"btn","btn-primary","w-100","mb-2",3,"disabled","click"],["class","fas fa-vote-yea me-1",4,"ngIf"],["class","fas fa-spinner fa-spin me-1",4,"ngIf"],[1,"fas","fa-vote-yea","me-1"],[1,"fas","fa-spinner","fa-spin","me-1"],[1,"fas","fa-music","fa-3x","text-muted","mb-3"],[1,"modal-backdrop","show",3,"click"],["tabindex","-1",1,"modal","show","d-block"],[1,"modal-dialog","modal-lg"],[1,"modal-content","card"],[1,"modal-header","card-header"],[1,"modal-title"],[1,"fas","fa-info-circle","me-2"],["type","button",1,"btn","btn-primary","w-100","mb-2",3,"click"],[1,"modal-body","card-body"],[1,"row"],[1,"col-md-4","text-center"],[1,"img-fluid","rounded","mb-3",3,"src","alt"],[1,"col-md-8"],[1,"row","mt-4"],[1,"col-6"],[1,"stat-box","text-center","p-3","rounded"],[1,"text-primary"],[1,"mb-0","text-muted"],[1,"text-success"],[1,"col-6","mt-3"],[1,"text-danger"],[1,"text-info"],[1,"mt-4"]],template:function(o,n){1&o&&(t.j41(0,"div",0)(1,"div",1),t.DNE(2,m,2,1,"div",2),t.k0s(),t.j41(3,"div",3)(4,"h1",4),t.nrm(5,"i",5),t.EFF(6,"Ranking Hist\xf3rico "),t.k0s(),t.j41(7,"p",6),t.EFF(8," Descubre las canciones m\xe1s populares que han sonado en nuestro restaurante "),t.k0s()(),t.j41(9,"div",7)(10,"div",8)(11,"div",9),t.nrm(12,"i",10),t.j41(13,"h3",11),t.EFF(14),t.k0s(),t.j41(15,"p",12),t.EFF(16,"Canciones totales"),t.k0s()()(),t.j41(17,"div",8)(18,"div",9),t.nrm(19,"i",13),t.j41(20,"h3",11),t.EFF(21),t.k0s(),t.j41(22,"p",12),t.EFF(23,"Reproducciones"),t.k0s()()(),t.j41(24,"div",8)(25,"div",9),t.nrm(26,"i",14),t.j41(27,"h3",11),t.EFF(28),t.k0s(),t.j41(29,"p",12),t.EFF(30,"Votos positivos"),t.k0s()()(),t.j41(31,"div",8)(32,"div",9),t.nrm(33,"i",15),t.j41(34,"h3",11),t.EFF(35),t.k0s(),t.j41(36,"p",12),t.EFF(37,"Votos negativos"),t.k0s()()()(),t.j41(38,"div",16)(39,"ul",17)(40,"li",18)(41,"a",19),t.bIt("click",function(){return n.setActiveTab("all")}),t.nrm(42,"i",20),t.EFF(43,"Todas "),t.k0s()(),t.j41(44,"li",18)(45,"a",19),t.bIt("click",function(){return n.setActiveTab("mostPlayed")}),t.nrm(46,"i",21),t.EFF(47,"M\xe1s reproducidas "),t.k0s()(),t.j41(48,"li",18)(49,"a",19),t.bIt("click",function(){return n.setActiveTab("mostVoted")}),t.nrm(50,"i",22),t.EFF(51,"M\xe1s votadas "),t.k0s()(),t.j41(52,"li",18)(53,"a",19),t.bIt("click",function(){return n.setActiveTab("bestRated")}),t.nrm(54,"i",23),t.EFF(55,"Mejor valoradas "),t.k0s()()()(),t.j41(56,"div",24)(57,"div",25)(58,"div",26)(59,"div",27)(60,"div",28),t.nrm(61,"i",29),t.j41(62,"input",30),t.bIt("ngModelChange",function(E){return n.filterText=E}),t.k0s(),t.DNE(63,s,2,0,"button",31),t.k0s(),t.j41(64,"p",6),t.EFF(65,"Presiona la canci\xf3n para ver los detalles"),t.k0s()(),t.j41(66,"div",32)(67,"div",33)(68,"span",34),t.EFF(69,"Ordenar por:"),t.k0s(),t.j41(70,"button",35),t.bIt("click",function(){return n.onSortChange("times_played")}),t.nrm(71,"i",21),t.EFF(72," Reproducciones "),t.nrm(73,"i"),t.k0s(),t.j41(74,"button",35),t.bIt("click",function(){return n.onSortChange("total_votes")}),t.nrm(75,"i",22),t.EFF(76," Votos "),t.nrm(77,"i"),t.k0s(),t.j41(78,"button",35),t.bIt("click",function(){return n.onSortChange("last_played_at")}),t.nrm(79,"i",36),t.EFF(80," Fecha "),t.nrm(81,"i"),t.k0s()()()()()(),t.DNE(82,l,3,1,"div",37),t.DNE(83,d,4,0,"div",38),t.DNE(84,g,2,1,"div",39),t.DNE(85,y,6,0,"div",38),t.DNE(86,S,1,0,"div",40),t.DNE(87,w,56,13,"div",41),t.k0s()),2&o&&(t.R7$(2),t.Y8G("ngIf",n.voteMessage),t.R7$(12),t.JRh(n.stats.totalSongs||0),t.R7$(7),t.JRh(n.stats.totalPlays||0),t.R7$(7),t.JRh(n.stats.totalVotes||0),t.R7$(7),t.JRh(n.stats.totalDislikes||0),t.R7$(6),t.AVh("active","all"===n.activeTab),t.R7$(4),t.AVh("active","mostPlayed"===n.activeTab),t.R7$(4),t.AVh("active","mostVoted"===n.activeTab),t.R7$(4),t.AVh("active","bestRated"===n.activeTab),t.R7$(9),t.Y8G("ngModel",n.filterText),t.R7$(1),t.Y8G("ngIf",n.filterText),t.R7$(10),t.ZvI("fas ",n.getSortIcon("times_played")," ms-1"),t.R7$(4),t.ZvI("fas ",n.getSortIcon("total_votes")," ms-1"),t.R7$(4),t.ZvI("fas ",n.getSortIcon("last_played_at")," ms-1"),t.R7$(1),t.Y8G("ngIf",n.error),t.R7$(1),t.Y8G("ngIf",n.isLoading),t.R7$(1),t.Y8G("ngIf",!n.isLoading&&n.getTabSongs().length>0),t.R7$(1),t.Y8G("ngIf",!n.isLoading&&0===n.getTabSongs().length),t.R7$(1),t.Y8G("ngIf",n.selectedSong),t.R7$(1),t.Y8G("ngIf",n.selectedSong))},dependencies:[_.MD,_.Sq,_.bT,f.YN,f.me,f.BC,f.vS,v.iI],styles:['.ranking-container[_ngcontent-%COMP%]{padding:1rem;max-width:1200px;margin:0 auto}@media (max-width: 768px){.ranking-container[_ngcontent-%COMP%]{padding:.5rem}}.header-section[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem;padding:1.5rem;background:linear-gradient(135deg,rgba(29,185,84,.1) 0%,rgba(25,20,20,.1) 100%);border-radius:16px}.header-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2.2rem;font-weight:800;margin-bottom:.5rem}@media (max-width: 768px){.header-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.8rem}}.header-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:1rem}.search-container[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;background:rgba(42,42,42,.6);border-radius:50px;padding:.5rem 1rem;transition:all .3s ease;border:1px solid rgba(62,62,62,.5)}.search-container[_ngcontent-%COMP%]:focus-within{border-color:var(--primary-color);box-shadow:0 0 0 2px #1db95440}.search-container[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]{color:var(--text-secondary);margin-right:.5rem}.search-container[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]{background:transparent;border:none;color:var(--text-primary);flex-grow:1;padding:.5rem 0}.search-container[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]:focus{outline:none}.search-container[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]::placeholder{color:var(--text-tertiary)}.search-container[_ngcontent-%COMP%]   .search-clear[_ngcontent-%COMP%]{background:transparent;border:none;color:var(--text-secondary);cursor:pointer;padding:.25rem;border-radius:50%}.search-container[_ngcontent-%COMP%]   .search-clear[_ngcontent-%COMP%]:hover{color:var(--text-primary);background:rgba(255,255,255,.1)}.songs-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1rem}@media (max-width: 768px){.songs-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:.75rem}}.spotify-card[_ngcontent-%COMP%]{background:rgba(42,42,42,.6);border-radius:8px;overflow:hidden;transition:all .3s ease;border:1px solid rgba(255,255,255,.05)}.spotify-card[_ngcontent-%COMP%]:hover{background:rgba(42,42,42,.8);transform:translateY(-2px);box-shadow:0 8px 24px #0003}.spotify-card[_ngcontent-%COMP%]:hover   .play-button[_ngcontent-%COMP%]{opacity:1;transform:translateY(0)}.spotify-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{padding:1rem;display:flex;gap:1rem}@media (max-width: 480px){.spotify-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{flex-direction:column;text-align:center;gap:.75rem}}.spotify-card[_ngcontent-%COMP%]   .song-image-container[_ngcontent-%COMP%]{position:relative;flex-shrink:0}.spotify-card[_ngcontent-%COMP%]   .song-image-container[_ngcontent-%COMP%]   .position-number[_ngcontent-%COMP%]{position:absolute;top:-8px;left:-8px;background:var(--primary-color);color:#000;font-weight:800;width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.8rem;z-index:2;box-shadow:0 2px 8px #1db95466}.spotify-card[_ngcontent-%COMP%]   .song-image-container[_ngcontent-%COMP%]   .song-image[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:6px;object-fit:cover;box-shadow:0 4px 12px #0000004d}@media (max-width: 480px){.spotify-card[_ngcontent-%COMP%]   .song-image-container[_ngcontent-%COMP%]   .song-image[_ngcontent-%COMP%]{width:100%;height:auto;max-height:160px}}.spotify-card[_ngcontent-%COMP%]   .song-image-container[_ngcontent-%COMP%]   .play-button[_ngcontent-%COMP%]{position:absolute;bottom:8px;right:8px;background:var(--primary-color);color:#000;border:none;border-radius:50%;width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;opacity:0;transform:translateY(8px);transition:all .3s ease;box-shadow:0 4px 12px #0000004d}.spotify-card[_ngcontent-%COMP%]   .song-image-container[_ngcontent-%COMP%]   .play-button[_ngcontent-%COMP%]:hover{transform:scale(1.1)}@media (max-width: 480px){.spotify-card[_ngcontent-%COMP%]   .song-image-container[_ngcontent-%COMP%]   .play-button[_ngcontent-%COMP%]{opacity:1;transform:none;bottom:16px;right:16px;width:40px;height:40px}}.spotify-card[_ngcontent-%COMP%]   .song-info[_ngcontent-%COMP%]{flex-grow:1;min-width:0}.spotify-card[_ngcontent-%COMP%]   .song-info[_ngcontent-%COMP%]   .song-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;margin:0 0 .25rem;color:var(--text-primary);cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.spotify-card[_ngcontent-%COMP%]   .song-info[_ngcontent-%COMP%]   .song-title[_ngcontent-%COMP%]:hover{color:var(--primary-color)}.spotify-card[_ngcontent-%COMP%]   .song-info[_ngcontent-%COMP%]   .song-artist[_ngcontent-%COMP%]{font-size:.9rem;color:var(--text-secondary);margin:0 0 .75rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.spotify-card[_ngcontent-%COMP%]   .song-info[_ngcontent-%COMP%]   .song-stats[_ngcontent-%COMP%]{display:flex;gap:.75rem;margin-bottom:.75rem;flex-wrap:wrap}.spotify-card[_ngcontent-%COMP%]   .song-info[_ngcontent-%COMP%]   .song-stats[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem;font-size:.8rem;color:var(--text-secondary)}.spotify-card[_ngcontent-%COMP%]   .song-info[_ngcontent-%COMP%]   .song-stats[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary-color)}.spotify-card[_ngcontent-%COMP%]   .song-info[_ngcontent-%COMP%]   .approval-container[_ngcontent-%COMP%]{margin-bottom:.75rem}.spotify-card[_ngcontent-%COMP%]   .song-info[_ngcontent-%COMP%]   .approval-container[_ngcontent-%COMP%]   .approval-bar[_ngcontent-%COMP%]{height:4px;background-color:#ffffff1a;border-radius:2px;overflow:hidden;margin-bottom:.25rem}.spotify-card[_ngcontent-%COMP%]   .song-info[_ngcontent-%COMP%]   .approval-container[_ngcontent-%COMP%]   .approval-bar[_ngcontent-%COMP%]   .approval-progress[_ngcontent-%COMP%]{height:100%;background:var(--primary-color);border-radius:2px;transition:width .5s ease}.spotify-card[_ngcontent-%COMP%]   .song-info[_ngcontent-%COMP%]   .approval-container[_ngcontent-%COMP%]   .approval-text[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary)}.spotify-card[_ngcontent-%COMP%]   .song-info[_ngcontent-%COMP%]   .last-played[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-tertiary);margin:0}.tabs-container[_ngcontent-%COMP%]{margin-bottom:1.5rem}.tabs-container[_ngcontent-%COMP%]   .nav-tabs[_ngcontent-%COMP%]{border-bottom:1px solid rgba(255,255,255,.1);display:flex;overflow-x:auto;scrollbar-width:none}.tabs-container[_ngcontent-%COMP%]   .nav-tabs[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.tabs-container[_ngcontent-%COMP%]   .nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]{flex-shrink:0}.tabs-container[_ngcontent-%COMP%]   .nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:var(--text-secondary);border:none;padding:.75rem 1rem;border-radius:0;position:relative;font-weight:600;white-space:nowrap}.tabs-container[_ngcontent-%COMP%]   .nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:0;left:0;width:0;height:2px;background:var(--primary-color);transition:width .3s ease}.tabs-container[_ngcontent-%COMP%]   .nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover{color:var(--text-primary);background:transparent}.tabs-container[_ngcontent-%COMP%]   .nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover:after{width:100%}.tabs-container[_ngcontent-%COMP%]   .nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{color:var(--text-primary);background:transparent}.tabs-container[_ngcontent-%COMP%]   .nav-tabs[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]:after{width:100%}.alert[_ngcontent-%COMP%]{border-radius:12px;border:none;box-shadow:0 4px 12px #00000026}.alert.alert-info[_ngcontent-%COMP%]{background:rgba(23,162,184,.9);color:#fff;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.alert.alert-danger[_ngcontent-%COMP%]{background:rgba(220,53,69,.9);color:#fff;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.alert[_ngcontent-%COMP%]   .btn-close[_ngcontent-%COMP%]{filter:invert(1)}.btn-closeee[_ngcontent-%COMP%]{background:rgba(3,59,17,.9);color:#030000;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}@keyframes _ngcontent-%COMP%_slideInDown{0%{transform:translateY(-20px);opacity:0}to{transform:translateY(0);opacity:1}}.alert-dismissible[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideInDown .3s ease-out}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:1rem;margin-bottom:2rem}@media (max-width: 480px){.stats-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}.stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]{background:rgba(42,42,42,.6);border-radius:8px;padding:1rem;text-align:center;border:1px solid rgba(255,255,255,.05);transition:all .3s ease}.stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]:hover{transform:translateY(-3px);box-shadow:0 6px 16px #0003;border-color:#1db95433}.stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-icon[_ngcontent-%COMP%]{font-size:1.5rem;color:var(--primary-color);margin-bottom:.5rem}.stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:800;margin-bottom:.25rem;color:var(--text-primary)}.stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-secondary);margin:0}.text-center[_ngcontent-%COMP%]{padding:3rem 1rem}.text-center[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]{border:3px solid rgba(29,185,84,.3);border-top-color:var(--primary-color);border-radius:50%;width:40px;height:40px;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:0 auto 1rem}.text-center[_ngcontent-%COMP%]   .fa-music[_ngcontent-%COMP%]{font-size:3rem;color:var(--text-tertiary);margin-bottom:1rem}.text-center[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:var(--text-secondary);margin-bottom:.5rem}.text-center[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-tertiary)}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.btn-outline-secondary[_ngcontent-%COMP%]{background:transparent;color:var(--text-secondary);border:1px solid var(--text-secondary);border-radius:50px;padding:.4rem .8rem;font-size:.85rem;display:inline-flex;align-items:center;transition:all .3s ease}.btn-outline-secondary[_ngcontent-%COMP%]:hover{background:rgba(255,255,255,.05);color:var(--text-primary);border-color:var(--text-primary)}.btn-outline-secondary[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-left:.25rem}.message-container[_ngcontent-%COMP%]{position:fixed;top:20px;right:20px;z-index:1000;max-width:400px}.success-message[_ngcontent-%COMP%], .error-message[_ngcontent-%COMP%], .progress-message[_ngcontent-%COMP%]{padding:12px 16px;border-radius:6px;margin-bottom:10px;box-shadow:0 4px 12px #0000004d;display:flex;align-items:center;animation:slideIn .3s ease}.success-message[_ngcontent-%COMP%]{background-color:#1db954e6;color:#000;border-left:4px solid #1DB954}']})}return r})()},3824:(R,C,a)=>{a.d(C,{U:()=>v});var _=a(4412),f=a(540);let v=(()=>{class t{audio;currentUrlSubject=new _.t(null);isPlayingSubject=new _.t(!1);currentUrl$=this.currentUrlSubject.asObservable();isPlaying$=this.isPlayingSubject.asObservable();constructor(){this.audio=new Audio,this.audio.addEventListener("ended",()=>{this.stop()}),this.audio.addEventListener("pause",()=>{this.isPlayingSubject.next(!1)}),this.audio.addEventListener("play",()=>{this.isPlayingSubject.next(!0)})}play(h){console.log("AudioService: Request to play",h),h?this.currentUrlSubject.value===h?this.audio.paused?(console.log("AudioService: Resuming audio"),this.audio.play().catch(p=>console.error("AudioService: Error resuming:",p))):(console.log("AudioService: Pausing audio"),this.audio.pause()):(console.log("AudioService: Playing new song"),this.stop(),this.audio.src=h,this.audio.load(),this.audio.play().then(()=>console.log("AudioService: Playback started")).catch(p=>console.error("AudioService: Error playing audio:",p)),this.currentUrlSubject.next(h)):console.warn("AudioService: No URL provided")}pause(){this.audio.pause()}stop(){this.audio.pause(),this.audio.currentTime=0,this.currentUrlSubject.next(null),this.isPlayingSubject.next(!1)}isCurrentSong(h){return this.currentUrlSubject.value===h}static \u0275fac=function(p){return new(p||t)};static \u0275prov=f.jDH({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})()},1180:(R,C,a)=>{a.d(C,{Z:()=>l});var _=a(605),f=a(7673),v=a(8810),t=a(8141),M=a(9172),h=a(5558),p=a(6354),x=a(9437),O=a(5312),P=a(540),m=a(1626),s=a(3205);let l=(()=>{class d{http;authService;apiUrl=O.c.apiUrl;cachedSongs=[];lastFetchTime=0;CACHE_DURATION=2e3;cachedVotingStatus=null;lastVotingStatusFetch=0;constructor(i,c){this.http=i,this.authService=c}getCacheBustedUrl(i){const c=i.includes("?")?"&":"?";return`${i}${c}_=${(new Date).getTime()}`}invalidateCache(){this.cachedSongs=[],this.lastFetchTime=0}invalidateVotingStatusCache(){this.cachedVotingStatus=null,this.lastVotingStatusFetch=0}processSongs(i){return i&&0!==i.length?i.sort((c,g)=>c.votes>g.votes?-1:c.votes<g.votes?1:new Date(g.createdat).getTime()-new Date(c.createdat).getTime()):[]}voteForSong(i,c,g=!1,y=""){return this.http.post(`${this.apiUrl}/api/vote`,{trackid:i,trackInfo:c,is_dislike:g,dedication:y}).pipe((0,t.M)(()=>{this.invalidateCache()}))}changeVote(i,c,g){return this.voteForSong(i,c,g)}getRankedSongsPolling(){return(0,_.Y)(3e4).pipe((0,M.Z)(0),(0,h.n)(()=>this.getRankedSongs()))}getRankedSongs(){const i=Date.now();if(this.cachedSongs.length>0&&i-this.lastFetchTime<this.CACHE_DURATION)return(0,f.of)([...this.cachedSongs]);const c=this.getCacheBustedUrl(`${this.apiUrl}/api/votes`);return this.http.get(c).pipe((0,p.T)(g=>{const y=this.processSongs(g||[]);return this.cachedSongs=y,this.lastFetchTime=i,y}))}getRecentlyAddedSongs(){return this.getRankedSongs().pipe((0,p.T)(i=>[...i].sort((c,g)=>new Date(g.createdat).getTime()-new Date(c.createdat).getTime()).slice(0,10)))}getSongs(){return this.getRankedSongs()}addToHistory(i){return this.http.post(`${this.apiUrl}/spotify/history`,{trackId:i})}vote(i,c,g=!1){return this.http.post(`${this.apiUrl}/vote`,{song:i,isDislike:c,isAdmin:g})}deleteSong(i){const c=this.authService.getAuthHeaders(),y=this.getCacheBustedUrl(`${this.apiUrl}/api/votes?trackid=${i}`);return this.http.delete(y,{headers:c}).pipe((0,t.M)(()=>{this.invalidateCache()}))}deleteAllVotes(){const i=this.authService.getAuthHeaders(),c=this.getCacheBustedUrl(`${this.apiUrl}/api/votes/all`);return this.http.delete(c,{headers:i}).pipe((0,t.M)(()=>{this.invalidateCache()}))}forceRefresh(){this.invalidateCache();const i=this.getCacheBustedUrl(`${this.apiUrl}/api/votes`);return this.http.get(i).pipe((0,p.T)(c=>{const g=this.processSongs(c||[]);return this.cachedSongs=g,this.lastFetchTime=Date.now(),g}))}getRankedSongsImmediate(){const i=this.getCacheBustedUrl(`${this.apiUrl}/api/votes`);return this.http.get(i).pipe((0,p.T)(c=>this.processSongs(c||[])))}getVotingStatus(){const i=this.getCacheBustedUrl(`${this.apiUrl}/api/voting/status`);return this.http.get(i)}submitVote(i){return this.http.post(`${this.apiUrl}/api/voting/vote`,{vote_type:i}).pipe((0,t.M)(()=>{this.invalidateVotingStatusCache()}),(0,x.W)(c=>{let g="Error al votar";return c.error?.error?g=c.error.error:400===c.status?g="Solicitud incorrecta":409===c.status?g=c.error?.error||"Ya has votado por esta opci\xf3n":500===c.status?g="Error del servidor":0===c.status&&(g="Error de conexi\xf3n"),this.invalidateVotingStatusCache(),(0,v.$)(()=>new Error(g))}))}getVotingStatusImmediate(){const i=this.getCacheBustedUrl(`${this.apiUrl}/api/voting/status`);return this.http.get(i)}static \u0275fac=function(c){return new(c||d)(P.KVO(m.Qq),P.KVO(s.u))};static \u0275prov=P.jDH({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})()},605:(R,C,a)=>{a.d(C,{Y:()=>v});var _=a(3888),f=a(1584);function v(t=0,M=_.E){return t<0&&(t=0),(0,f.O)(t,t,M)}},1584:(R,C,a)=>{a.d(C,{O:()=>M});var _=a(1985),f=a(3888),v=a(9470);function M(h=0,p,x=f.b){let O=-1;return null!=p&&((0,v.m)(p)?x=p:O=p),new _.c(P=>{let m=function t(h){return h instanceof Date&&!isNaN(h)}(h)?+h-x.now():h;m<0&&(m=0);let s=0;return x.schedule(function(){P.closed||(P.next(s++),0<=O?this.schedule(void 0,O):P.complete())},m)})}},3888:(R,C,a)=>{a.d(C,{b:()=>P,E:()=>O});var _=a(8359);class f extends _.yU{constructor(s,l){super()}schedule(s,l=0){return this}}const v={setInterval(m,s,...l){const{delegate:d}=v;return d?.setInterval?d.setInterval(m,s,...l):setInterval(m,s,...l)},clearInterval(m){const{delegate:s}=v;return(s?.clearInterval||clearInterval)(m)},delegate:void 0};var t=a(7908);const h={now:()=>(h.delegate||Date).now(),delegate:void 0};class p{constructor(s,l=p.now){this.schedulerActionCtor=s,this.now=l}schedule(s,l=0,d){return new this.schedulerActionCtor(this,s).schedule(d,l)}}p.now=h.now;const O=new class x extends p{constructor(s,l=p.now){super(s,l),this.actions=[],this._active=!1}flush(s){const{actions:l}=this;if(this._active)return void l.push(s);let d;this._active=!0;do{if(d=s.execute(s.state,s.delay))break}while(s=l.shift());if(this._active=!1,d){for(;s=l.shift();)s.unsubscribe();throw d}}}(class M extends f{constructor(s,l){super(s,l),this.scheduler=s,this.work=l,this.pending=!1}schedule(s,l=0){var d;if(this.closed)return this;this.state=s;const k=this.id,i=this.scheduler;return null!=k&&(this.id=this.recycleAsyncId(i,k,l)),this.pending=!0,this.delay=l,this.id=null!==(d=this.id)&&void 0!==d?d:this.requestAsyncId(i,this.id,l),this}requestAsyncId(s,l,d=0){return v.setInterval(s.flush.bind(s,this),d)}recycleAsyncId(s,l,d=0){if(null!=d&&this.delay===d&&!1===this.pending)return l;null!=l&&v.clearInterval(l)}execute(s,l){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const d=this._execute(s,l);if(d)return d;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(s,l){let k,d=!1;try{this.work(s)}catch(i){d=!0,k=i||new Error("Scheduled action threw falsy error")}if(d)return this.unsubscribe(),k}unsubscribe(){if(!this.closed){const{id:s,scheduler:l}=this,{actions:d}=l;this.work=this.state=this.scheduler=null,this.pending=!1,(0,t.o)(d,this),null!=s&&(this.id=this.recycleAsyncId(l,s,null)),this.delay=null,super.unsubscribe()}}}),P=O}}]);